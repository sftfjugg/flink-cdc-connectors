

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>OceanBase CDC Connector &mdash; CDC Connectors for Apache Flink®  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/favicon.png"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Oracle CDC Connector" href="oracle-cdc.html" />
    <link rel="prev" title="MySQL CDC 连接器" href="mysql-cdc%28ZH%29.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> CDC Connectors for Apache Flink®
          

          
          </a>

          
            
            
              <div class="version">
                master
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../about.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/index.html">快速上手</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Connectors</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="mongodb-cdc.html">MongoDB CDC Connector</a></li>
<li class="toctree-l2"><a class="reference internal" href="mysql-cdc.html">MySQL CDC Connector</a></li>
<li class="toctree-l2"><a class="reference internal" href="mysql-cdc%28ZH%29.html">MySQL CDC 连接器</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">OceanBase CDC Connector</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#dependencies">Dependencies</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#sql-client-jar">SQL Client JAR</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#setup-oceanbase-and-logproxy-server">Setup OceanBase and LogProxy Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-create-a-oceanbase-cdc-table">How to create a OceanBase CDC table</a></li>
<li class="toctree-l3"><a class="reference internal" href="#connector-options">Connector Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#available-metadata">Available Metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="#features">Features</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#at-least-once-processing">At-Least-Once Processing</a></li>
<li class="toctree-l4"><a class="reference internal" href="#startup-reading-position">Startup Reading Position</a></li>
<li class="toctree-l4"><a class="reference internal" href="#consume-commit-log">Consume Commit Log</a></li>
<li class="toctree-l4"><a class="reference internal" href="#datastream-source">DataStream Source</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#data-type-mapping">Data Type Mapping</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="oracle-cdc.html">Oracle CDC Connector</a></li>
<li class="toctree-l2"><a class="reference internal" href="postgres-cdc.html">Postgres CDC Connector</a></li>
<li class="toctree-l2"><a class="reference internal" href="sqlserver-cdc.html">SQLServer CDC Connector</a></li>
<li class="toctree-l2"><a class="reference internal" href="tidb-cdc.html">TiDB CDC Connector</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../formats/index.html">Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="../downloads.html">Downloads</a></li>
<li class="toctree-l1"><a class="reference internal" href="../githublink.html"><a class="github-button" href="https://github.com/ververica/flink-cdc-connectors" data-color-scheme="no-preference: dark_high_contrast; light: dark_high_contrast; dark: dark_high_contrast;" data-size="large" data-show-count="true" aria-label="Star ververica/flink-cdc-connectors on GitHub">Star</a></a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">CDC Connectors for Apache Flink®</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          <!--
 ~ Copyright 2022 Ververica Inc.
 ~
 ~ Licensed under the Apache License, Version 2.0 (the "License");
 ~ you may not use this file except in compliance with the License.
 ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
-->

<!-- Extend the RTD template to support user defined "Edit on Github" URL -->

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Connectors</a> &raquo;</li>
        
      <li>OceanBase CDC Connector</li>
    
    
            <li class="wy-breadcrumbs-aside">
                
                    
                        <a href="http://github.com/ververica/flink-cdc-connectors/blob/master/docs/content/connectors/oceanbase-cdc.md" class="fa fa-github"> Edit on GitHub</a>
                    
                
            </li>
        
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section class="tex2jax_ignore mathjax_ignore" id="oceanbase-cdc-connector">
<h1>OceanBase CDC Connector<a class="headerlink" href="#oceanbase-cdc-connector" title="Permalink to this headline">¶</a></h1>
<p>The OceanBase CDC connector allows for reading snapshot data and incremental data from OceanBase. This document describes how to setup the OceanBase CDC connector to run SQL queries against OceanBase.</p>
<section id="dependencies">
<h2>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h2>
<p>In order to setup the OceanBase CDC connector, the following table provides dependency information for both projects using a build automation tool (such as Maven or SBT) and SQL Client with SQL JAR bundles.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.ververica<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>flink-connector-oceanbase-cdc<span class="nt">&lt;/artifactId&gt;</span>
  <span class="c">&lt;!-- The dependency is available only for stable releases, SNAPSHOT dependency need build by yourself. --&gt;</span>
  <span class="nt">&lt;version&gt;</span>2.3-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
<section id="sql-client-jar">
<h3>SQL Client JAR<a class="headerlink" href="#sql-client-jar" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Download</span> <span class="pre">link</span> <span class="pre">is</span> <span class="pre">available</span> <span class="pre">only</span> <span class="pre">for</span> <span class="pre">stable</span> <span class="pre">releases.</span></code></p>
<p>Download <a class="reference external" href="https://repo1.maven.org/maven2/com/ververica/flink-sql-connector-oceanbase-cdc/2.3-SNAPSHOT/flink-sql-connector-oceanbase-cdc-2.3-SNAPSHOT.jar">flink-sql-connector-oceanbase-cdc-2.3-SNAPSHOT.jar</a> and put it under <code class="docutils literal notranslate"><span class="pre">&lt;FLINK_HOME&gt;/lib/</span></code>.</p>
<p><strong>Note:</strong> flink-sql-connector-oceanbase-cdc-XXX-SNAPSHOT version is the code corresponding to the development branch. Users need to download the source code and compile the corresponding jar. Users should use the released version, such as <a class="reference external" href="https://mvnrepository.com/artifact/com.ververica/flink-sql-connector-oceanbase-cdc">flink-sql-connector-oceanbase-cdc-2.2.1.jar</a>, the released version will be available in the Maven central warehouse.</p>
</section>
</section>
<section id="setup-oceanbase-and-logproxy-server">
<h2>Setup OceanBase and LogProxy Server<a class="headerlink" href="#setup-oceanbase-and-logproxy-server" title="Permalink to this headline">¶</a></h2>
<ol>
<li><p>Setup the OceanBase cluster following the <a class="reference external" href="https://open.oceanbase.com/docs/community/oceanbase-database/V3.1.1/deploy-the-distributed-oceanbase-cluster">deployment doc</a>.</p></li>
<li><p>Create a user with password in <code class="docutils literal notranslate"><span class="pre">sys</span></code> tenant, this user is used in OceanBase LogProxy. See <a class="reference external" href="https://open.oceanbase.com/docs/community/oceanbase-database/V3.1.1/create-user-3">user management doc</a>.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mysql -h<span class="si">${</span><span class="nv">host</span><span class="si">}</span> -P<span class="si">${</span><span class="nv">port</span><span class="si">}</span> -uroot

mysql&gt; SHOW TENANT<span class="p">;</span>
mysql&gt; CREATE USER <span class="si">${</span><span class="nv">sys_username</span><span class="si">}</span> IDENTIFIED BY <span class="s1">&#39;${sys_password}&#39;</span><span class="p">;</span>
mysql&gt; GRANT ALL PRIVILEGES ON *.* TO <span class="si">${</span><span class="nv">sys_username</span><span class="si">}</span> WITH GRANT OPTION<span class="p">;</span>
</pre></div>
</div>
</li>
<li><p>Create a user in the tenant you want to monitor, this is used to read data for snapshot and change event.</p></li>
<li><p>For users of OceanBase Community Edition, you need to get the <code class="docutils literal notranslate"><span class="pre">rootserver-list</span></code>. You can use the following command to get the value:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mysql&gt; show parameters like <span class="s1">&#39;rootservice_list&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>For users of OceanBase Enterprise Edition, you need to get the <code class="docutils literal notranslate"><span class="pre">config-url</span></code>. You can use the following command to get the value:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mysql&gt; show parameters like <span class="s1">&#39;obconfig_url&#39;</span><span class="p">;</span>
</pre></div>
</div>
</li>
<li><p>Setup OceanBase LogProxy. For users of OceanBase Community Edition, you can follow the <a class="reference external" href="https://github.com/oceanbase/oblogproxy#quick-start">quick start</a>.</p></li>
</ol>
</section>
<section id="how-to-create-a-oceanbase-cdc-table">
<h2>How to create a OceanBase CDC table<a class="headerlink" href="#how-to-create-a-oceanbase-cdc-table" title="Permalink to this headline">¶</a></h2>
<p>The OceanBase CDC table can be defined as following:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- checkpoint every 3000 milliseconds                       </span>
<span class="n">Flink</span> <span class="k">SQL</span><span class="o">&gt;</span> <span class="k">SET</span> <span class="s1">&#39;execution.checkpointing.interval&#39;</span> <span class="o">=</span> <span class="s1">&#39;3s&#39;</span><span class="p">;</span>

<span class="c1">-- register a OceanBase table &#39;orders&#39; in Flink SQL</span>
<span class="n">Flink</span> <span class="k">SQL</span><span class="o">&gt;</span> <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">orders</span> <span class="p">(</span>
    <span class="n">order_id</span>     <span class="nb">INT</span><span class="p">,</span>
    <span class="n">order_date</span>   <span class="k">TIMESTAMP</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">customer_name</span> <span class="n">STRING</span><span class="p">,</span>
    <span class="n">price</span>        <span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
    <span class="n">product_id</span>   <span class="nb">INT</span><span class="p">,</span>
    <span class="n">order_status</span> <span class="nb">BOOLEAN</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">order_id</span><span class="p">)</span> <span class="k">NOT</span> <span class="n">ENFORCED</span>
<span class="p">)</span> <span class="k">WITH</span> <span class="p">(</span>
    <span class="s1">&#39;connector&#39;</span> <span class="o">=</span> <span class="s1">&#39;oceanbase-cdc&#39;</span><span class="p">,</span>
    <span class="s1">&#39;scan.startup.mode&#39;</span> <span class="o">=</span> <span class="s1">&#39;initial&#39;</span><span class="p">,</span>
    <span class="s1">&#39;username&#39;</span> <span class="o">=</span> <span class="s1">&#39;user@test_tenant&#39;</span><span class="p">,</span>
    <span class="s1">&#39;password&#39;</span> <span class="o">=</span> <span class="s1">&#39;pswd&#39;</span><span class="p">,</span>
    <span class="s1">&#39;tenant-name&#39;</span> <span class="o">=</span> <span class="s1">&#39;test_tenant&#39;</span><span class="p">,</span>
    <span class="s1">&#39;database-name&#39;</span> <span class="o">=</span> <span class="s1">&#39;test_db&#39;</span><span class="p">,</span>
    <span class="s1">&#39;table-name&#39;</span> <span class="o">=</span> <span class="s1">&#39;orders&#39;</span><span class="p">,</span>
    <span class="s1">&#39;hostname&#39;</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;port&#39;</span> <span class="o">=</span> <span class="s1">&#39;2881&#39;</span><span class="p">,</span>
    <span class="s1">&#39;rootserver-list&#39;</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1:2882:2881&#39;</span><span class="p">,</span>
    <span class="s1">&#39;logproxy.host&#39;</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;logproxy.port&#39;</span> <span class="o">=</span> <span class="s1">&#39;2983&#39;</span><span class="p">,</span>
    <span class="s1">&#39;working-mode&#39;</span> <span class="o">=</span> <span class="s1">&#39;memory&#39;</span>
<span class="p">);</span>

<span class="c1">-- read snapshot and binlogs from orders table</span>
<span class="n">Flink</span> <span class="k">SQL</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">orders</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="connector-options">
<h2>Connector Options<a class="headerlink" href="#connector-options" title="Permalink to this headline">¶</a></h2>
<p>The OceanBase CDC Connector contains some options for both sql and stream api as the following sheet.</p>
<p><em>Note</em>: The connector supports two ways to specify the table list to listen to, and will get the union of the results when both way are used at the same time.</p>
<ol class="simple">
<li><p>Use <code class="docutils literal notranslate"><span class="pre">database-name</span></code> and <code class="docutils literal notranslate"><span class="pre">table-name</span></code> to match database and table names in regex. As the <code class="docutils literal notranslate"><span class="pre">obcdc</span></code> (former <code class="docutils literal notranslate"><span class="pre">liboblog</span></code>) only supports <code class="docutils literal notranslate"><span class="pre">fnmatch</span></code> now, we can’t use regex directly to filter change events, so these two options can only be used in <code class="docutils literal notranslate"><span class="pre">initial</span></code> startup mode.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">table-list</span></code> to match the exact value of database and table names.</p></li>
</ol>
<div class="highlight">
    <table class="colwidths-auto docutils">
        <thead>
            <tr>
                <th class="text-left" style="width: 10%">Option</th>
                <th class="text-left" style="width: 8%">Required</th>
                <th class="text-left" style="width: 7%">Default</th>
                <th class="text-left" style="width: 10%">Type</th>
                <th class="text-left" style="width: 65%">Description</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>connector</td>
                <td>required</td>
                <td style="word-wrap: break-word;">(none)</td>
                <td>String</td>
                <td>Specify what connector to use, here should be <code>'oceanbase-cdc'</code>.</td>
            </tr>
            <tr>
                <td>scan.startup.mode</td>
                <td>required</td>
                <td style="word-wrap: break-word;">(none)</td>
                <td>String</td>
                <td>Specify the startup mode for OceanBase CDC consumer, valid enumerations are
                    <code>'initial'</code>,<code>'latest-offset'</code> or <code>'timestamp'</code>.
                </td>
            </tr>
            <tr>
                <td>scan.startup.timestamp</td>
                <td>optional</td>
                <td style="word-wrap: break-word;">(none)</td>
                <td>Long</td>
                <td>Timestamp in seconds of the start point, only used for <code>'timestamp'</code> startup mode.</td>
            </tr>
            <tr>
                <td>username</td>
                <td>required</td>
                <td style="word-wrap: break-word;">(none)</td>
                <td>String</td>
                <td>Username to be used when connecting to OceanBase.</td>
            </tr>
            <tr>
                <td>password</td>
                <td>required</td>
                <td style="word-wrap: break-word;">(none)</td>
                <td>String</td>
                <td>Password to be used when connecting to OceanBase.</td>
            </tr>
            <tr>
                <td>tenant-name</td>
                <td>required</td>
                <td style="word-wrap: break-word;">(none)</td>
                <td>String</td>
                <td>Tenant name of OceanBase to monitor, should be exact value.</td>
            </tr>
            <tr>
                <td>database-name</td>
                <td>optional</td>
                <td style="word-wrap: break-word;">(none)</td>
                <td>String</td>
                <td>Database name of OceanBase to monitor, should be regular expression. Only can be used with 'initial' mode.</td>
            </tr>
            <tr>
                <td>table-name</td>
                <td>optional</td>
                <td style="word-wrap: break-word;">(none)</td>
                <td>String</td>
                <td>Table name of OceanBase to monitor, should be regular expression. Only can be used with 'initial' mode.</td>
            </tr>
            <tr>
                <td>table-list</td>
                <td>optional</td>
                <td style="word-wrap: break-word;">(none)</td>
                <td>String</td>
                <td>List of full names of tables, separated by commas, e.g. "db1.table1, db2.table2".</td>
            </tr>
            <tr>
                <td>hostname</td>
                <td>optional</td>
                <td style="word-wrap: break-word;">(none)</td>
                <td>String</td>
                <td>IP address or hostname of the OceanBase database server or OceanBase Proxy server.</td>
            </tr>
            <tr>
                <td>port</td>
                <td>optional</td>
                <td style="word-wrap: break-word;">(none)</td>
                <td>Integer</td>
                <td>Integer port number to connect to OceanBase. It can be the SQL port of OceanBase server, which is 2881 by default, or the port of OceanBase proxy service, which is 2883 by default.</td>
            </tr>
            <tr>
                <td>connect.timeout</td>
                <td>optional</td>
                <td style="word-wrap: break-word;">30s</td>
                <td>Duration</td>
                <td>The maximum time that the connector should wait after trying to connect to the OceanBase database server before timing out.</td>
            </tr>
            <tr>
                <td>server-time-zone</td>
                <td>optional</td>
                <td style="word-wrap: break-word;">+00:00</td>
                <td>String</td>
                <td>The session timezone which controls how temporal types are converted to STRING in OceanBase. Can be UTC offset in format "±hh:mm", or named time zones if the time zone information tables in the mysql database have been created and populated.</td>
            </tr>
            <tr>
                <td>logproxy.host</td>
                <td>required</td>
                <td style="word-wrap: break-word;">(none)</td>
                <td>String</td>
                <td>Hostname or IP address of OceanBase log proxy service.</td>
            </tr>
            <tr>
                <td>logproxy.port</td>
                <td>required</td>
                <td style="word-wrap: break-word;">(none)</td>
                <td>Integer</td>
                <td>Port number of OceanBase log proxy service.</td>
            </tr>
            <tr>
                <td>logproxy.client.id</td>
                <td>optional</td>
                <td style="word-wrap: break-word;">By rule.</td>
                <td>String</td>
                <td>Id of a log proxy client connection, will be in format {flink_ip}_{process_id}_{timestamp}_{thread_id}_{tenant} by default.</td>
            </tr>
            <tr>
                <td>rootserver-list</td>
                <td>optional</td>
                <td style="word-wrap: break-word;">(none)</td>
                <td>String</td>
                <td>The semicolon-separated list of OceanBase root servers in format `ip:rpc_port:sql_port`, required for OceanBase CE.</td>
            </tr>
            <tr>
                <td>config-url</td>
                <td>optional</td>
                <td style="word-wrap: break-word;">(none)</td>
                <td>String</td>
                <td>The url to get the server info from the config server, required for OceanBase EE.</td>
            </tr>
            <tr>
                <td>working-mode</td>
                <td>optional</td>
                <td style="word-wrap: break-word;">storage</td>
                <td>String</td>
                <td>Working mode of `obcdc` in LogProxy, can be `storage` or `memory`.</td>
            </tr>
        </tbody>
    </table>
</div>
</section>
<section id="available-metadata">
<h2>Available Metadata<a class="headerlink" href="#available-metadata" title="Permalink to this headline">¶</a></h2>
<p>The following format metadata can be exposed as read-only (VIRTUAL) columns in a table definition.</p>
<table class="colwidths-auto docutils">
    <thead>
        <tr>
            <th class="text-left" style="width: 15%">Key</th>
            <th class="text-left" style="width: 30%">DataType</th>
            <th class="text-left" style="width: 55%">Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>tenant_name</td>
            <td>STRING NOT NULL</td>
            <td>Name of the tenant that contains the row.</td>
        </tr>
        <tr>
            <td>database_name</td>
            <td>STRING NOT NULL</td>
            <td>Name of the database that contains the row.</td>
        </tr>
        <tr>
            <td>table_name</td>
            <td>STRING NOT NULL</td>
            <td>Name of the table that contains the row.</td>
        </tr>
        <tr>
            <td>op_ts</td>
            <td>TIMESTAMP_LTZ(3) NOT NULL</td>
            <td>It indicates the time that the change was made in the database. <br>
                If the record is read from snapshot of the table instead of the change stream, the value is always 0.</td>
        </tr>
    </tbody>
</table>
<p>The extended CREATE TABLE example demonstrates the syntax for exposing these metadata fields:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">products</span> <span class="p">(</span>
    <span class="n">tenant_name</span> <span class="n">STRING</span> <span class="n">METADATA</span> <span class="k">FROM</span> <span class="s1">&#39;tenant_name&#39;</span> <span class="n">VIRTUAL</span><span class="p">,</span>
    <span class="n">db_name</span> <span class="n">STRING</span> <span class="n">METADATA</span> <span class="k">FROM</span> <span class="s1">&#39;database_name&#39;</span> <span class="n">VIRTUAL</span><span class="p">,</span>
    <span class="k">table_name</span> <span class="n">STRING</span> <span class="n">METADATA</span>  <span class="k">FROM</span> <span class="s1">&#39;table_name&#39;</span> <span class="n">VIRTUAL</span><span class="p">,</span>
    <span class="n">operation_ts</span> <span class="n">TIMESTAMP_LTZ</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="n">METADATA</span> <span class="k">FROM</span> <span class="s1">&#39;op_ts&#39;</span> <span class="n">VIRTUAL</span><span class="p">,</span>
    <span class="n">order_id</span> <span class="nb">INT</span><span class="p">,</span>
    <span class="n">order_date</span> <span class="k">TIMESTAMP</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">customer_name</span> <span class="n">STRING</span><span class="p">,</span>
    <span class="n">price</span> <span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
    <span class="n">product_id</span> <span class="nb">INT</span><span class="p">,</span>
    <span class="n">order_status</span> <span class="nb">BOOLEAN</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="n">order_id</span><span class="p">)</span> <span class="k">NOT</span> <span class="n">ENFORCED</span>
<span class="p">)</span> <span class="k">WITH</span> <span class="p">(</span>
   <span class="s1">&#39;connector&#39;</span> <span class="o">=</span> <span class="s1">&#39;oceanbase-cdc&#39;</span><span class="p">,</span>
   <span class="s1">&#39;scan.startup.mode&#39;</span> <span class="o">=</span> <span class="s1">&#39;initial&#39;</span><span class="p">,</span>
   <span class="s1">&#39;username&#39;</span> <span class="o">=</span> <span class="s1">&#39;user@test_tenant&#39;</span><span class="p">,</span>
   <span class="s1">&#39;password&#39;</span> <span class="o">=</span> <span class="s1">&#39;pswd&#39;</span><span class="p">,</span>
   <span class="s1">&#39;tenant-name&#39;</span> <span class="o">=</span> <span class="s1">&#39;test_tenant&#39;</span><span class="p">,</span>
   <span class="s1">&#39;database-name&#39;</span> <span class="o">=</span> <span class="s1">&#39;test_db&#39;</span><span class="p">,</span>
   <span class="s1">&#39;table-name&#39;</span> <span class="o">=</span> <span class="s1">&#39;orders&#39;</span><span class="p">,</span>
   <span class="s1">&#39;hostname&#39;</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
   <span class="s1">&#39;port&#39;</span> <span class="o">=</span> <span class="s1">&#39;2881&#39;</span><span class="p">,</span>
   <span class="s1">&#39;rootserver-list&#39;</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1:2882:2881&#39;</span><span class="p">,</span>
   <span class="s1">&#39;logproxy.host&#39;</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
   <span class="s1">&#39;logproxy.port&#39;</span> <span class="o">=</span> <span class="s1">&#39;2983&#39;</span><span class="p">,</span>
   <span class="s1">&#39;working-mode&#39;</span> <span class="o">=</span> <span class="s1">&#39;memory&#39;</span>
<span class="p">);</span>
</pre></div>
</div>
</section>
<section id="features">
<h2>Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h2>
<section id="at-least-once-processing">
<h3>At-Least-Once Processing<a class="headerlink" href="#at-least-once-processing" title="Permalink to this headline">¶</a></h3>
<p>The OceanBase CDC connector is a Flink Source connector which will read database snapshot first and then continues to read change events with <strong>at-least-once processing</strong>.</p>
<p>OceanBase is a kind of distributed database whose log files are distributed on different servers. As there is no position information like MySQL binlog offset, we can only use timestamp as the position mark. In order to ensure the completeness of reading data, <code class="docutils literal notranslate"><span class="pre">liboblog</span></code> (a C++ library to read OceanBase log record) might read some log data before the given timestamp. So in this way we may read duplicate data whose timestamp is around the start point, and only ‘at-least-once’ can be guaranteed.</p>
</section>
<section id="startup-reading-position">
<h3>Startup Reading Position<a class="headerlink" href="#startup-reading-position" title="Permalink to this headline">¶</a></h3>
<p>The config option <code class="docutils literal notranslate"><span class="pre">scan.startup.mode</span></code> specifies the startup mode for OceanBase CDC consumer. The valid enumerations are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">initial</span></code>: Performs an initial snapshot on the monitored table upon first startup, and continue to read the latest commit log.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">latest-offset</span></code>: Never to perform snapshot on the monitored table upon first startup and just read the latest commit log since the connector is started.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">timestamp</span></code>: Never to perform snapshot on the monitored table upon first startup and just read the commit log from the given <code class="docutils literal notranslate"><span class="pre">scan.startup.timestamp</span></code>.</p></li>
</ul>
</section>
<section id="consume-commit-log">
<h3>Consume Commit Log<a class="headerlink" href="#consume-commit-log" title="Permalink to this headline">¶</a></h3>
<p>The OceanBase CDC Connector using <a class="reference external" href="https://github.com/oceanbase/oblogclient">oblogclient</a> to consume commit log from OceanBase LogProxy.</p>
</section>
<section id="datastream-source">
<h3>DataStream Source<a class="headerlink" href="#datastream-source" title="Permalink to this headline">¶</a></h3>
<p>The OceanBase CDC connector can also be a DataStream source. You can create a SourceFunction as the following shows:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.apache.flink.streaming.api.environment.StreamExecutionEnvironment</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.streaming.api.functions.source.SourceFunction</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.ververica.cdc.connectors.oceanbase.OceanBaseSource</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.ververica.cdc.connectors.oceanbase.table.OceanBaseTableSourceFactory</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.ververica.cdc.connectors.oceanbase.table.StartupMode</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.ververica.cdc.debezium.JsonDebeziumDeserializationSchema</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OceanBaseSourceExample</span> <span class="p">{</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
    <span class="n">SourceFunction</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">oceanBaseSource</span> <span class="o">=</span>
        <span class="n">OceanBaseSource</span><span class="p">.</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="n">builder</span><span class="p">()</span>
            <span class="p">.</span><span class="na">rsList</span><span class="p">(</span><span class="s">&quot;127.0.0.1:2882:2881&quot;</span><span class="p">)</span>  <span class="c1">// set root server list</span>
            <span class="p">.</span><span class="na">startupMode</span><span class="p">(</span><span class="n">StartupMode</span><span class="p">.</span><span class="na">INITIAL</span><span class="p">)</span> <span class="c1">// set startup mode</span>
            <span class="p">.</span><span class="na">username</span><span class="p">(</span><span class="s">&quot;user@test_tenant&quot;</span><span class="p">)</span>  <span class="c1">// set cluster username</span>
            <span class="p">.</span><span class="na">password</span><span class="p">(</span><span class="s">&quot;pswd&quot;</span><span class="p">)</span>  <span class="c1">// set cluster password</span>
            <span class="p">.</span><span class="na">tenantName</span><span class="p">(</span><span class="s">&quot;test_tenant&quot;</span><span class="p">)</span>  <span class="c1">// set captured tenant name, do not support regex</span>
            <span class="p">.</span><span class="na">databaseName</span><span class="p">(</span><span class="s">&quot;test_db&quot;</span><span class="p">)</span>  <span class="c1">// set captured database, support regex</span>
            <span class="p">.</span><span class="na">tableName</span><span class="p">(</span><span class="s">&quot;test_table&quot;</span><span class="p">)</span>  <span class="c1">// set captured table, support regex</span>
            <span class="p">.</span><span class="na">hostname</span><span class="p">(</span><span class="s">&quot;127.0.0.1&quot;</span><span class="p">)</span>  <span class="c1">// set hostname of OceanBase server or proxy</span>
            <span class="p">.</span><span class="na">port</span><span class="p">(</span><span class="mi">2881</span><span class="p">)</span>  <span class="c1">// set the sql port for OceanBase server or proxy</span>
            <span class="p">.</span><span class="na">logProxyHost</span><span class="p">(</span><span class="s">&quot;127.0.0.1&quot;</span><span class="p">)</span>  <span class="c1">// set the hostname of log proxy</span>
            <span class="p">.</span><span class="na">logProxyPort</span><span class="p">(</span><span class="mi">2983</span><span class="p">)</span>  <span class="c1">// set the port of log proxy</span>
            <span class="p">.</span><span class="na">deserializer</span><span class="p">(</span><span class="k">new</span> <span class="n">JsonDebeziumDeserializationSchema</span><span class="p">())</span>  <span class="c1">// converts SourceRecord to JSON String</span>
            <span class="p">.</span><span class="na">build</span><span class="p">();</span>

    <span class="n">StreamExecutionEnvironment</span> <span class="n">env</span> <span class="o">=</span> <span class="n">StreamExecutionEnvironment</span><span class="p">.</span><span class="na">getExecutionEnvironment</span><span class="p">();</span>

    <span class="c1">// enable checkpoint</span>
    <span class="n">env</span><span class="p">.</span><span class="na">enableCheckpointing</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span>
    
    <span class="n">env</span><span class="p">.</span><span class="na">addSource</span><span class="p">(</span><span class="n">oceanBaseSource</span><span class="p">).</span><span class="na">print</span><span class="p">().</span><span class="na">setParallelism</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="n">env</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="s">&quot;Print OceanBase Snapshot + Commit Log&quot;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="data-type-mapping">
<h2>Data Type Mapping<a class="headerlink" href="#data-type-mapping" title="Permalink to this headline">¶</a></h2>
<p>When the startup mode is not <code class="docutils literal notranslate"><span class="pre">INITIAL</span></code>, we will not be able to get the precision and scale of a column. In order to be compatible with different startup modes, we will not map one OceanBase type of different precision to different FLink types.</p>
<p>For example, you can get a boolean from a column with type BOOLEAN, TINYINT(1) or BIT(1). BOOLEAN is equivalent to TINYINT(1) in OceanBase, so columns of BOOLEAN and TINYINT types will be mapped to TINYINT in Flink, and BIT(1) will be mapped to BINARY(1) in Flink.</p>
<div class="wy-table-responsive">
    <table class="colwidths-auto docutils">
        <thead>
            <tr>
                <th class="text-left">OceanBase type</th>
                <th class="text-left">Flink SQL type</th>
                <th class="text-left">NOTE</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>BOOLEAN<br>
                    TINYINT</td>
                <td>TINYINT</td>
                <td></td>
            </tr>
            <tr>
                <td>
                    SMALLINT<br>
                    TINYINT UNSIGNED</td>
                <td>SMALLINT</td>
                <td></td>
            </tr>
            <tr>
                <td>
                    INT<br>
                    MEDIUMINT<br>
                    SMALLINT UNSIGNED</td>
                <td>INT</td>
                <td></td>
            </tr>
            <tr>
                <td>
                    BIGINT<br>
                    INT UNSIGNED</td>
                <td>BIGINT</td>
                <td></td>
            </tr>
            <tr>
                <td>BIGINT UNSIGNED</td>
                <td>DECIMAL(20, 0)</td>
                <td></td>
            </tr>
            <tr>
                <td>
                    REAL<br>
                    FLOAT<br>
                </td>
                <td>FLOAT</td>
                <td></td>
            </tr>
            <tr>
                <td>
                    DOUBLE
                </td>
                <td>DOUBLE</td>
                <td></td>
            </tr>
            <tr>
                <td>
                    NUMERIC(p, s)<br>
                    DECIMAL(p, s)<br>
                    where p <= 38<br>
                </td>
                <td>DECIMAL(p, s)</td>
                <td></td>
            </tr>
            <tr>
                <td>
                    NUMERIC(p, s)<br>
                    DECIMAL(p, s)<br>
                    where 38 < p <=65<br>
                </td>
                <td>STRING</td>
                <td>DECIMAL is equivalent to NUMERIC. The precision for DECIMAL data type is up to 65 in OceanBase, but
                    the precision for DECIMAL is limited to 38 in Flink.
                    So if you define a decimal column whose precision is greater than 38, you should map it to STRING to
                    avoid precision loss.</td>
            </tr>
            <tr>
                <td>DATE</td>
                <td>DATE</td>
                <td></td>
            </tr>
            <tr>
                <td>TIME [(p)]</td>
                <td>TIME [(p)]</td>
                <td></td>
            </tr>
            <tr>
                <td>TIMESTAMP [(p)]<br>
                    DATETIME [(p)]
                </td>
                <td>TIMESTAMP [(p)]
                </td>
                <td></td>
            </tr>
            <tr>
                <td>CHAR(n)</td>
                <td>CHAR(n)</td>
                <td></td>
            </tr>
            <tr>
                <td>VARCHAR(n)</td>
                <td>VARCHAR(n)</td>
                <td></td>
            </tr>
            <tr>
                <td>BIT(n)</td>
                <td>BINARY(⌈n/8⌉)</td>
                <td></td>
            </tr>
            <tr>
                <td>BINARY(n)</td>
                <td>BINARY(n)</td>
                <td></td>
            </tr>
            <tr>
                <td>VARBINARY(N)</td>
                <td>VARBINARY(N)</td>
                <td></td>
            </tr>
            <tr>
                <td>
                    TINYTEXT<br>
                    TEXT<br>
                    MEDIUMTEXT<br>
                    LONGTEXT<br>
                </td>
                <td>STRING</td>
                <td></td>
            </tr>
            <tr>
                <td>
                    TINYBLOB<br>
                    BLOB<br>
                    MEDIUMBLOB<br>
                    LONGBLOB<br>
                </td>
                <td>BYTES</td>
                <td></td>
            </tr>
            <tr>
                <td>YEAR</td>
                <td>INT</td>
                <td></td>
            </tr>
            <tr>
                <td>ENUM</td>
                <td>STRING</td>
                <td></td>
            </tr>
            <tr>
                <td>SET</td>
                <td>STRING</td>
                <td></td>
            </tr>
        </tbody>
    </table>
</div>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="oracle-cdc.html" class="btn btn-neutral float-right" title="Oracle CDC Connector" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="mysql-cdc%28ZH%29.html" class="btn btn-neutral float-left" title="MySQL CDC 连接器" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2022, Ververica GmbH; Apache Flink, Flink®, Apache®, the squirrel logo, and the Apache feather logo are either registered trademarks or trademarks of The Apache Software Foundation.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  <!--
 ~ Copyright 2022 Ververica Inc.
 ~
 ~ Licensed under the Apache License, Version 2.0 (the "License");
 ~ you may not use this file except in compliance with the License.
 ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
-->



<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      version: master
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        
        <dl>
            <dt>Versions</dt>
            
             <strong> 
            <dd><a href="/flink-cdc-connectors/master/">master</a></dd>
             </strong> 
            
            
            <dd><a href="/flink-cdc-connectors/release-1.4/">release-1.4</a></dd>
            
            
            
            <dd><a href="/flink-cdc-connectors/release-2.0/">release-2.0</a></dd>
            
            
            
            <dd><a href="/flink-cdc-connectors/release-2.1/">release-2.1</a></dd>
            
            
            
            <dd><a href="/flink-cdc-connectors/release-2.2/">release-2.2</a></dd>
            
            
        </dl>
        
        
        <hr/>
        Free document hosting provided by <a href="http://www.readthedocs.org">Read the
        Docs</a>.

    </div>
</div>

<!-- Place this tag in your head or just before your close body tag. -->
<script async defer
        src="https://ververica.github.io/flink-cdc-connectors/master/_static/button.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>