

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>MySQL CDC Connector &mdash; Flink CDC 2.0.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Postgres CDC Connector" href="postgres-cdc.html" />
    <link rel="prev" title="Connectors" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Flink CDC
          

          
          </a>

          
            
            
              <div class="version">
                release-1.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../about.html">About Flink CDC</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Connectors</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">MySQL CDC Connector</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#dependencies">Dependencies</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#maven-dependency">Maven dependency</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sql-client-jar">SQL Client JAR</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#setup-mysql-server">Setup MySQL server</a></li>
<li class="toctree-l3"><a class="reference internal" href="#notes">Notes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#how-mysql-cdc-source-works">How MySQL CDC source works</a></li>
<li class="toctree-l4"><a class="reference internal" href="#grant-reload-permission-for-mysql-user">Grant RELOAD permission for MySQL user</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-global-read-lock-flush-tables-with-read-lock">The global read lock (FLUSH TABLES WITH READ LOCK)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-a-differnet-server-id-for-each-job">Set a differnet SERVER ID for each job</a></li>
<li class="toctree-l4"><a class="reference internal" href="#can-t-perform-checkpoint-during-scaning-database-tables">Can’t perform checkpoint during scaning database tables</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setting-up-mysql-session-timeouts">Setting up MySQL session timeouts</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-create-a-mysql-cdc-table">How to create a MySQL CDC table</a></li>
<li class="toctree-l3"><a class="reference internal" href="#connector-options">Connector Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#features">Features</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#exactly-once-processing">Exactly-Once Processing</a></li>
<li class="toctree-l4"><a class="reference internal" href="#startup-reading-position">Startup Reading Position</a></li>
<li class="toctree-l4"><a class="reference internal" href="#single-thread-reading">Single Thread Reading</a></li>
<li class="toctree-l4"><a class="reference internal" href="#datastream-source">DataStream Source</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#data-type-mapping">Data Type Mapping</a></li>
<li class="toctree-l3"><a class="reference internal" href="#faq">FAQ</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#q1-how-to-skip-snapshot-and-only-read-from-binlog">Q1: How to skip snapshot and only read from binlog?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#q2-how-to-read-a-shared-database-that-contains-multiple-tables-e-g-user-00-user-01-user-99">Q2: How to read a shared database that contains multiple tables, e.g. user_00, user_01, …, user_99 ?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#q3-connectexception-received-dml-for-processing-binlog-probably-contains-events-generated-with-statement-or-mixed-based-replication-format">Q3: ConnectException: Received DML ‘…’ for processing, binlog probably contains events generated with statement or mixed based replication format</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="postgres-cdc.html">Postgres CDC Connector</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../formats/index.html">Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../downloads.html">Downloads</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Flink CDC</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Connectors</a> &raquo;</li>
        
      <li>MySQL CDC Connector</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            
              <a href="https://github.com/ververica/flink-cdc-connectors/blob/release-1.4content/connectors/mysql-cdc.md" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section class="tex2jax_ignore mathjax_ignore" id="mysql-cdc-connector">
<h1>MySQL CDC Connector<a class="headerlink" href="#mysql-cdc-connector" title="Permalink to this headline">¶</a></h1>
<p>The MySQL CDC connector allows for reading snapshot data and incremental data from MySQL database. This document describes how to setup the MySQL CDC connector to run SQL queries against MySQL databases.</p>
<section id="dependencies">
<h2>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h2>
<p>In order to setup the MySQL CDC connector, the following table provides dependency information for both projects using a build automation tool (such as Maven or SBT) and SQL Client with SQL JAR bundles.</p>
<section id="maven-dependency">
<h3>Maven dependency<a class="headerlink" href="#maven-dependency" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">dependency</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">com</span><span class="o">.</span><span class="n">alibaba</span><span class="o">.</span><span class="n">ververica</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">flink</span><span class="o">-</span><span class="n">connector</span><span class="o">-</span><span class="n">mysql</span><span class="o">-</span><span class="n">cdc</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span><span class="mf">1.4.0</span><span class="o">&lt;/</span><span class="n">version</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">dependency</span><span class="o">&gt;</span>
</pre></div>
</div>
</section>
<section id="sql-client-jar">
<h3>SQL Client JAR<a class="headerlink" href="#sql-client-jar" title="Permalink to this headline">¶</a></h3>
<p>Download <a class="reference external" href="https://repo1.maven.org/maven2/com/alibaba/ververica/flink-sql-connector-mysql-cdc/1.4.0/flink-sql-connector-mysql-cdc-1.4.0.jar">flink-sql-connector-mysql-cdc-1.4.0.jar</a> and put it under <code class="docutils literal notranslate"><span class="pre">&lt;FLINK_HOME&gt;/lib/</span></code>.</p>
</section>
</section>
<section id="setup-mysql-server">
<h2>Setup MySQL server<a class="headerlink" href="#setup-mysql-server" title="Permalink to this headline">¶</a></h2>
<p>You have to define a MySQL user with appropriate permissions on all databases that the Debezium MySQL connector monitors.</p>
<ol class="simple">
<li><p>Create the MySQL user:</p></li>
</ol>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">CREATE</span> <span class="k">USER</span> <span class="s1">&#39;user&#39;</span><span class="o">@</span><span class="s1">&#39;localhost&#39;</span> <span class="n">IDENTIFIED</span> <span class="k">BY</span> <span class="s1">&#39;password&#39;</span><span class="p">;</span>
</pre></div>
</div>
<ol class="simple">
<li><p>Grant the required permissions to the user:</p></li>
</ol>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">GRANT</span> <span class="k">SELECT</span><span class="p">,</span> <span class="n">RELOAD</span><span class="p">,</span> <span class="k">SHOW</span> <span class="n">DATABASES</span><span class="p">,</span> <span class="n">REPLICATION</span> <span class="n">SLAVE</span><span class="p">,</span> <span class="n">REPLICATION</span> <span class="n">CLIENT</span> <span class="k">ON</span> <span class="o">*</span><span class="p">.</span><span class="o">*</span> <span class="k">TO</span> <span class="s1">&#39;user&#39;</span> <span class="n">IDENTIFIED</span> <span class="k">BY</span> <span class="s1">&#39;password&#39;</span><span class="p">;</span>
</pre></div>
</div>
<ol class="simple">
<li><p>Finalize the user’s permissions:</p></li>
</ol>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="n">FLUSH</span> <span class="k">PRIVILEGES</span><span class="p">;</span>
</pre></div>
</div>
<p>See more about the <a class="reference external" href="https://debezium.io/documentation/reference/1.2/connectors/mysql.html#_permissions_explained">permission explanation</a>.</p>
</section>
<section id="notes">
<h2>Notes<a class="headerlink" href="#notes" title="Permalink to this headline">¶</a></h2>
<section id="how-mysql-cdc-source-works">
<h3>How MySQL CDC source works<a class="headerlink" href="#how-mysql-cdc-source-works" title="Permalink to this headline">¶</a></h3>
<p>When the MySQL CDC source is started, it grabs a global read lock (<code class="docutils literal notranslate"><span class="pre">FLUSH</span> <span class="pre">TABLES</span> <span class="pre">WITH</span> <span class="pre">READ</span> <span class="pre">LOCK</span></code>) that blocks writes by other database. Then it reads current binlog position and the schema of the databases and tables. After that, the global read lock is released. Then it scans the database tables and reads binlog from the previous recorded position. Flink will periodically perform checkpoints to record the binlog position. In case of failover, the job will restart and restore from the checkpointed binlog position. Consequently, it guarantees the exactly once semantic.</p>
</section>
<section id="grant-reload-permission-for-mysql-user">
<h3>Grant RELOAD permission for MySQL user<a class="headerlink" href="#grant-reload-permission-for-mysql-user" title="Permalink to this headline">¶</a></h3>
<p>If the MySQL user is not granted the RELOAD permission, the MySQL CDC source will use table-level locks instead and performs a snapshot with this method. This blocks write for a longer time.</p>
</section>
<section id="the-global-read-lock-flush-tables-with-read-lock">
<h3>The global read lock (FLUSH TABLES WITH READ LOCK)<a class="headerlink" href="#the-global-read-lock-flush-tables-with-read-lock" title="Permalink to this headline">¶</a></h3>
<p>The global read lock is hold during reading binlog position and schema. It may takes seconds which is depending on the numbers of tables. The global read lock blocks writes, so it may still affect online business. If you want to skip the read lock, and can tolerate at-least-once semantic, you can add <code class="docutils literal notranslate"><span class="pre">'debezium.snapshot.locking.mode'</span> <span class="pre">=</span> <span class="pre">'none'</span></code> option to skip the lock.</p>
</section>
<section id="set-a-differnet-server-id-for-each-job">
<h3>Set a differnet SERVER ID for each job<a class="headerlink" href="#set-a-differnet-server-id-for-each-job" title="Permalink to this headline">¶</a></h3>
<p>Every MySQL database client for reading binlog should have an unique id, called server id. MySQL server will use this id to maintain network connection and the binlog position. Therefore, if different jobs share a same server id, it may result to reading from wrong binlog position.
Thus, it is recommended to set different server id for each job via the <a class="reference external" href="https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/sql/hints.html">SQL Hints</a>, e.g. <code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">*</span> <span class="pre">FROM</span> <span class="pre">source_table</span> <span class="pre">/*+</span> <span class="pre">OPTIONS('server-id'='123456')</span> <span class="pre">*/</span> <span class="pre">;</span></code>.</p>
<p>Tip: By default the server id is randomed when the TaskManager is started up. If TaskManager is failed down, it may have a different server id when starting up again. But this shouldn’t happen frequently (job exception doesn’t restart TaskManager), and shouldn’t affect MySQL server too much.</p>
</section>
<section id="can-t-perform-checkpoint-during-scaning-database-tables">
<h3>Can’t perform checkpoint during scaning database tables<a class="headerlink" href="#can-t-perform-checkpoint-during-scaning-database-tables" title="Permalink to this headline">¶</a></h3>
<p>During scanning tables, since there is no recoverable position, we can’t perform checkpoints. In order to not perform checkpoints, MySQL CDC source will keep the checkpoint waiting to timeout. The timemout checkpoint will be recognized as failed checkpoint, by default, this will trigger a failover for the Flink job. So if the database table is large, it is recommended to add following Flink configurations to avoid failover because of the timeout checkpoints:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">execution</span><span class="o">.</span><span class="n">checkpointing</span><span class="o">.</span><span class="n">interval</span><span class="p">:</span> <span class="mi">10</span><span class="nb">min</span>
<span class="n">execution</span><span class="o">.</span><span class="n">checkpointing</span><span class="o">.</span><span class="n">tolerable</span><span class="o">-</span><span class="n">failed</span><span class="o">-</span><span class="n">checkpoints</span><span class="p">:</span> <span class="mi">100</span>
<span class="n">restart</span><span class="o">-</span><span class="n">strategy</span><span class="p">:</span> <span class="n">fixed</span><span class="o">-</span><span class="n">delay</span>
<span class="n">restart</span><span class="o">-</span><span class="n">strategy</span><span class="o">.</span><span class="n">fixed</span><span class="o">-</span><span class="n">delay</span><span class="o">.</span><span class="n">attempts</span><span class="p">:</span> <span class="mi">2147483647</span>
</pre></div>
</div>
</section>
<section id="setting-up-mysql-session-timeouts">
<h3>Setting up MySQL session timeouts<a class="headerlink" href="#setting-up-mysql-session-timeouts" title="Permalink to this headline">¶</a></h3>
<p>When an initial consistent snapshot is made for large databases, your established connection could timeout while the tables are being read. You can prevent this behavior by configuring interactive_timeout and wait_timeout in your MySQL configuration file.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">interactive_timeout</span></code>: The number of seconds the server waits for activity on an interactive connection before closing it. See <a class="reference external" href="https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_interactive_timeout">MySQL documentations</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wait_timeout</span></code>: The number of seconds the server waits for activity on a noninteractive connection before closing it. See <a class="reference external" href="https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_wait_timeout">MySQL documentations</a>.</p></li>
</ul>
</section>
</section>
<section id="how-to-create-a-mysql-cdc-table">
<h2>How to create a MySQL CDC table<a class="headerlink" href="#how-to-create-a-mysql-cdc-table" title="Permalink to this headline">¶</a></h2>
<p>The MySQL CDC table can be defined as following:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- register a MySQL table &#39;orders&#39; in Flink SQL</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">orders</span> <span class="p">(</span>
  <span class="n">order_id</span> <span class="nb">INT</span><span class="p">,</span>
  <span class="n">order_date</span> <span class="k">TIMESTAMP</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
  <span class="n">customer_name</span> <span class="n">STRING</span><span class="p">,</span>
  <span class="n">price</span> <span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
  <span class="n">product_id</span> <span class="nb">INT</span><span class="p">,</span>
  <span class="n">order_status</span> <span class="nb">BOOLEAN</span>
<span class="p">)</span> <span class="k">WITH</span> <span class="p">(</span>
  <span class="s1">&#39;connector&#39;</span> <span class="o">=</span> <span class="s1">&#39;mysql-cdc&#39;</span><span class="p">,</span>
  <span class="s1">&#39;hostname&#39;</span> <span class="o">=</span> <span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
  <span class="s1">&#39;port&#39;</span> <span class="o">=</span> <span class="s1">&#39;3306&#39;</span><span class="p">,</span>
  <span class="s1">&#39;username&#39;</span> <span class="o">=</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
  <span class="s1">&#39;password&#39;</span> <span class="o">=</span> <span class="s1">&#39;123456&#39;</span><span class="p">,</span>
  <span class="s1">&#39;database-name&#39;</span> <span class="o">=</span> <span class="s1">&#39;mydb&#39;</span><span class="p">,</span>
  <span class="s1">&#39;table-name&#39;</span> <span class="o">=</span> <span class="s1">&#39;orders&#39;</span>
<span class="p">);</span>

<span class="c1">-- read snapshot and binlogs from orders table</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">orders</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="connector-options">
<h2>Connector Options<a class="headerlink" href="#connector-options" title="Permalink to this headline">¶</a></h2>
<div class="highlight">
<table class="colwidths-auto docutils">
    <thead>
      <tr>
        <th class="text-left" style="width: 10%">Option</th>
        <th class="text-left" style="width: 8%">Required</th>
        <th class="text-left" style="width: 7%">Default</th>
        <th class="text-left" style="width: 10%">Type</th>
        <th class="text-left" style="width: 65%">Description</th>
      </tr>
    </thead>
    <tbody>
    <tr>
      <td>connector</td>
      <td>required</td>
      <td style="word-wrap: break-word;">(none)</td>
      <td>String</td>
      <td>Specify what connector to use, here should be <code>'mysql-cdc'</code>.</td>
    </tr>
    <tr>
      <td>hostname</td>
      <td>required</td>
      <td style="word-wrap: break-word;">(none)</td>
      <td>String</td>
      <td>IP address or hostname of the MySQL database server.</td>
    </tr>
    <tr>
      <td>username</td>
      <td>required</td>
      <td style="word-wrap: break-word;">(none)</td>
      <td>String</td>
      <td>Name of the MySQL database to use when connecting to the MySQL database server.</td>
    </tr>
    <tr>
      <td>password</td>
      <td>required</td>
      <td style="word-wrap: break-word;">(none)</td>
      <td>String</td>
      <td>Password to use when connecting to the MySQL database server.</td>
    </tr>
    <tr>
      <td>database-name</td>
      <td>required</td>
      <td style="word-wrap: break-word;">(none)</td>
      <td>String</td>
      <td>Database name of the MySQL server to monitor. The database-name also supports regular expressions to monitor multiple tables matches the regular expression.</td>
    </tr> 
    <tr>
      <td>table-name</td>
      <td>required</td>
      <td style="word-wrap: break-word;">(none)</td>
      <td>String</td>
      <td>Table name of the MySQL database to monitor. The table-name also supports regular expressions to monitor multiple tables matches the regular expression.</td>
    </tr>
    <tr>
      <td>port</td>
      <td>optional</td>
      <td style="word-wrap: break-word;">3306</td>
      <td>Integer</td>
      <td>Integer port number of the MySQL database server.</td>
    </tr>
    <tr>
      <td>server-id</td>
      <td>optional</td>
      <td style="word-wrap: break-word;">(none)</td>
      <td>Integer</td>
      <td>A numeric ID of this database client, which must be unique across all currently-running database processes in the MySQL cluster.
          This connector joins the MySQL database cluster as another server (with this unique ID) so it can read the binlog.
          By default, a random number is generated between 5400 and 6400, though we recommend setting an explicit value.</td>
    </tr> 
    <tr>
      <td>scan.startup.mode</td>
      <td>optional</td>
      <td style="word-wrap: break-word;">initial</td>
      <td>String</td>
      <td>Optional startup mode for MySQL CDC consumer, valid enumerations are "initial"
           and "latest-offset". 
           Please see <a href="#startup-reading-position">Startup Reading Position</a>section for more detailed information.</td>
    </tr> 
    <tr>
      <td>server-time-zone</td>
      <td>optional</td>
      <td style="word-wrap: break-word;">UTC</td>
      <td>String</td>
      <td>The session time zone in database server, e.g. "Asia/Shanghai". 
          It controls how the TIMESTAMP type in MYSQL converted to STRING.
          See more <a href="https://debezium.io/documentation/reference/1.2/connectors/mysql.html#_temporal_values">here</a>.</td>
    </tr>
    <tr>
      <td>debezium.min.row.
      count.to.stream.result</td>
      <td>optional</td>
      <td style="word-wrap: break-word;">1000</td>
      <td>Integer</td>
      <td>	
During a snapshot operation, the connector will query each included table to produce a read event for all rows in that table. This parameter determines whether the MySQL connection will pull all results for a table into memory (which is fast but requires large amounts of memory), or whether the results will instead be streamed (can be slower, but will work for very large tables). The value specifies the minimum number of rows a table must contain before the connector will stream results, and defaults to 1,000. Set this parameter to '0' to skip all table size checks and always stream all results during a snapshot.</td>
    </tr>
    <tr>
      <td>debezium.snapshot.
      fetch.size</td>
      <td>optional</td>
      <td style="word-wrap: break-word;">(none)</td>
      <td>Integer</td>
      <td>Specifies the maximum number of rows that should be read in one go from each table while taking a snapshot. The connector will read the table contents in multiple batches of this size.</td>
    </tr>
   <tr>
      <td>debezium.*</td>
      <td>optional</td>
      <td style="word-wrap: break-word;">(none)</td>
      <td>String</td>
      <td>Pass-through Debezium's properties to Debezium Embedded Engine which is used to capture data changes from MySQL server.
          For example: <code>'debezium.snapshot.mode' = 'never'</code>.
          See more about the <a href="https://debezium.io/documentation/reference/1.2/connectors/mysql.html#mysql-connector-configuration-properties_debezium">Debezium's MySQL Connector properties</a></td> 
    </tr>
    </tbody>
</table>
</div>
</section>
<section id="features">
<h2>Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h2>
<section id="exactly-once-processing">
<h3>Exactly-Once Processing<a class="headerlink" href="#exactly-once-processing" title="Permalink to this headline">¶</a></h3>
<p>The MySQL CDC connector is a Flink Source connector which will read database snapshot first and then continues to read binlogs with <strong>exactly-once processing</strong> even failures happen. Please read <a class="reference external" href="https://debezium.io/documentation/reference/1.2/connectors/mysql.html#how-the-mysql-connector-performs-database-snapshots_debezium">How the connector performs database snapshot</a>.</p>
</section>
<section id="startup-reading-position">
<h3>Startup Reading Position<a class="headerlink" href="#startup-reading-position" title="Permalink to this headline">¶</a></h3>
<p>The config option <code class="docutils literal notranslate"><span class="pre">scan.startup.mode</span></code> specifies the startup mode for MySQL CDC consumer. The valid enumerations are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">initial</span></code> (default): Performs an initial snapshot on the monitored database tables upon first startup, and continue to read the latest binlog.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">latest-offset</span></code>: Never to perform snapshot on the monitored database tables upon first startup, just read from
the end of the binlog which means only have the changes since the connector was started.</p></li>
</ul>
<p><em>Note: the mechanism of <code class="docutils literal notranslate"><span class="pre">scan.startup.mode</span></code> option relying on Debezium’s <code class="docutils literal notranslate"><span class="pre">snapshot.mode</span></code> configuration. So please do not using them together. If you speicifying both <code class="docutils literal notranslate"><span class="pre">scan.startup.mode</span></code> and <code class="docutils literal notranslate"><span class="pre">debezium.snapshot.mode</span></code> options in the table DDL, it may make <code class="docutils literal notranslate"><span class="pre">scan.startup.mode</span></code> doesn’t work.</em></p>
</section>
<section id="single-thread-reading">
<h3>Single Thread Reading<a class="headerlink" href="#single-thread-reading" title="Permalink to this headline">¶</a></h3>
<p>The MySQL CDC source can’t work in parallel reading, because there is only one task can receive binlog events.</p>
</section>
<section id="datastream-source">
<h3>DataStream Source<a class="headerlink" href="#datastream-source" title="Permalink to this headline">¶</a></h3>
<p>The MySQL CDC connector can also be a DataStream source. You can create a SourceFunction as the following shows:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.apache.flink.streaming.api.environment.StreamExecutionEnvironment</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.streaming.api.functions.source.SourceFunction</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.alibaba.ververica.cdc.debezium.StringDebeziumDeserializationSchema</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.alibaba.ververica.cdc.connectors.mysql.MySQLSource</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MySqlBinlogSourceExample</span> <span class="p">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
    <span class="n">SourceFunction</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">sourceFunction</span> <span class="o">=</span> <span class="n">MySQLSource</span><span class="p">.</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="n">builder</span><span class="p">()</span>
      <span class="p">.</span><span class="na">hostname</span><span class="p">(</span><span class="s">&quot;localhost&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="na">port</span><span class="p">(</span><span class="mi">3306</span><span class="p">)</span>
      <span class="p">.</span><span class="na">databaseList</span><span class="p">(</span><span class="s">&quot;inventory&quot;</span><span class="p">)</span> <span class="c1">// monitor all tables under inventory database</span>
      <span class="p">.</span><span class="na">username</span><span class="p">(</span><span class="s">&quot;flinkuser&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="na">password</span><span class="p">(</span><span class="s">&quot;flinkpw&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="na">deserializer</span><span class="p">(</span><span class="k">new</span> <span class="n">StringDebeziumDeserializationSchema</span><span class="p">())</span> <span class="c1">// converts SourceRecord to String</span>
      <span class="p">.</span><span class="na">build</span><span class="p">();</span>

    <span class="n">StreamExecutionEnvironment</span> <span class="n">env</span> <span class="o">=</span> <span class="n">StreamExecutionEnvironment</span><span class="p">.</span><span class="na">getExecutionEnvironment</span><span class="p">();</span>

    <span class="n">env</span>
      <span class="p">.</span><span class="na">addSource</span><span class="p">(</span><span class="n">sourceFunction</span><span class="p">)</span>
      <span class="p">.</span><span class="na">print</span><span class="p">().</span><span class="na">setParallelism</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// use parallelism 1 for sink to keep message ordering</span>

    <span class="n">env</span><span class="p">.</span><span class="na">execute</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="data-type-mapping">
<h2>Data Type Mapping<a class="headerlink" href="#data-type-mapping" title="Permalink to this headline">¶</a></h2>
<div class="wy-table-responsive">
<table class="colwidths-auto docutils">
    <thead>
      <tr>
        <th class="text-left">MySQL type<a href="https://dev.mysql.com/doc/man/8.0/en/data-types.html"></a></th>
        <th class="text-left">Flink SQL type<a href="{% link dev/table/types.md %}"></a></th>
      </tr>
    </thead>
    <tbody>
    <tr>
      <td>TINYINT</td>
      <td>TINYINT</td>
    </tr>
    <tr>
      <td>
        SMALLINT<br>
        TINYINT UNSIGNED</td>
      <td>SMALLINT</td>
    </tr>
    <tr>
      <td>
        INT<br>
        MEDIUMINT<br>
        SMALLINT UNSIGNED</td>
      <td>INT</td>
    </tr>
    <tr>
      <td>
        BIGINT<br>
        INT UNSIGNED</td>
      <td>BIGINT</td>
    </tr>
   <tr>
      <td>BIGINT UNSIGNED</td>
      <td>DECIMAL(20, 0)</td>
    </tr>
    <tr>
      <td>BIGINT</td>
      <td>BIGINT</td>
    </tr>
    <tr>
      <td>FLOAT</td>
      <td>FLOAT</td>
    </tr>
    <tr>
      <td>
        DOUBLE<br>
        DOUBLE PRECISION</td>
      <td>DOUBLE</td>
    </tr>
    <tr>
      <td>
        NUMERIC(p, s)<br>
         DECIMAL(p, s)</td>
      <td>DECIMAL(p, s)</td>
    </tr>
    <tr>
      <td>
        BOOLEAN<br>
         TINYINT(1)</td>
      <td>BOOLEAN</td>
    </tr>
    <tr>
      <td>DATE</td>
      <td>DATE</td>
    </tr>
    <tr>
      <td>TIME [(p)]</td>
      <td>TIME [(p)] [WITHOUT TIMEZONE]</td>
    </tr>
    <tr>
      <td>DATETIME [(p)]</td>
      <td>TIMESTAMP [(p)] [WITHOUT TIMEZONE]</td>
    </tr>
    <tr>
      <td>TIMESTAMP [(p)]</td>
      <td>TIMESTAMP [(p)]<br>
          TIMESTAMP [(p)] WITH LOCAL TIME ZONE
      </td>
    </tr>
    <tr>
      <td>
        CHAR(n)<br>
        VARCHAR(n)<br>
        TEXT</td>
      <td>STRING</td>
    </tr>
    <tr>
      <td>
        BINARY<br>
        VARBINARY<br>
        BLOB</td>
      <td>BYTES</td>
    </tr>
    </tbody>
</table>
</div>
</section>
<section id="faq">
<h2>FAQ<a class="headerlink" href="#faq" title="Permalink to this headline">¶</a></h2>
<section id="q1-how-to-skip-snapshot-and-only-read-from-binlog">
<h3>Q1: How to skip snapshot and only read from binlog?<a class="headerlink" href="#q1-how-to-skip-snapshot-and-only-read-from-binlog" title="Permalink to this headline">¶</a></h3>
<p>Please see <a class="reference external" href="#startup-reading-position">Startup Reading Position</a> section.</p>
</section>
<section id="q2-how-to-read-a-shared-database-that-contains-multiple-tables-e-g-user-00-user-01-user-99">
<h3>Q2: How to read a shared database that contains multiple tables, e.g. user_00, user_01, …, user_99 ?<a class="headerlink" href="#q2-how-to-read-a-shared-database-that-contains-multiple-tables-e-g-user-00-user-01-user-99" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">table-name</span></code> option supports regular expressions to monitor multiple tables matches the regular expression. So you can set <code class="docutils literal notranslate"><span class="pre">table-name</span></code> to <code class="docutils literal notranslate"><span class="pre">user_.*</span></code> to monitor all the <code class="docutils literal notranslate"><span class="pre">user_</span></code> prefix tables. The same to the <code class="docutils literal notranslate"><span class="pre">database-name</span></code> option. Note that the shared table should be in the same schema.</p>
</section>
<section id="q3-connectexception-received-dml-for-processing-binlog-probably-contains-events-generated-with-statement-or-mixed-based-replication-format">
<h3>Q3: ConnectException: Received DML ‘…’ for processing, binlog probably contains events generated with statement or mixed based replication format<a class="headerlink" href="#q3-connectexception-received-dml-for-processing-binlog-probably-contains-events-generated-with-statement-or-mixed-based-replication-format" title="Permalink to this headline">¶</a></h3>
<p>If there is above exception, please check <code class="docutils literal notranslate"><span class="pre">binlog_format</span></code> is <code class="docutils literal notranslate"><span class="pre">ROW</span></code>, you can check this by running <code class="docutils literal notranslate"><span class="pre">show</span> <span class="pre">variables</span> <span class="pre">like</span> <span class="pre">'%binlog_format%'</span></code> in MySQL client. Please note that even if the <code class="docutils literal notranslate"><span class="pre">binlog_format</span></code> configuration of your database is <code class="docutils literal notranslate"><span class="pre">ROW</span></code>, this configuration can be changed by other sessions, for example, <code class="docutils literal notranslate"><span class="pre">SET</span> <span class="pre">SESSION</span> <span class="pre">binlog_format='MIXED';</span> <span class="pre">SET</span> <span class="pre">SESSION</span> <span class="pre">tx_isolation='REPEATABLE-READ';</span> <span class="pre">COMMIT;</span></code>. Please also make sure there are no other session are changing this configuration.</p>
</section>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="postgres-cdc.html" class="btn btn-neutral float-right" title="Postgres CDC Connector" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="index.html" class="btn btn-neutral float-left" title="Connectors" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2022, ververica.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  <!--
  ~ Licensed to the Apache Software Foundation (ASF) under one
  ~ or more contributor license agreements.  See the NOTICE file
  ~ distributed with this work for additional information
  ~ regarding copyright ownership.  The ASF licenses this file
  ~ to you under the Apache License, Version 2.0 (the
  ~ "License"); you may not use this file except in compliance
  ~ with the License.  You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
-->



  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      version: release-1.4
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <dl>
        <dt>Versions</dt>
        
          
          <dd><a href="/flink-cdc-connectors/master/">master</a></dd>
          
        
           <strong> 
          <dd><a href="/flink-cdc-connectors/release-1.4/">release-1.4</a></dd>
           </strong> 
        
          
          <dd><a href="/flink-cdc-connectors/release-2.0/">release-2.0</a></dd>
          
        
          
          <dd><a href="/flink-cdc-connectors/release-2.1/">release-2.1</a></dd>
          
        
          
          <dd><a href="/flink-cdc-connectors/release-2.2/">release-2.2</a></dd>
          
        
      </dl>
      
      
      <hr/>
      Free document hosting provided by <a href="http://www.readthedocs.org">Read the Docs</a>.
 
    </div>
  </div>

 

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>